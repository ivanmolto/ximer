<!DOCTYPE html>
<html lang="en">
<head>
    <base href="/" />
    <title>Fullstack Academy Generated Application</title>
    <link rel="stylesheet" type="text/css" href="/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Montserrat:400,700">

    <script src="/lodash/index.js"></script>
    <script src="/angular/angular.js"></script>
    <script src="/angular-ui-router/release/angular-ui-router.js"></script>
    <script src="/angular-bootstrap/dist/ui-bootstrap.js"></script>
    <script src="/socket.io-client/socket.io.js"></script>
    <script type="text/javascript" src="http://cdn.tonejs.org/latest/Tone.min.js"></script>
    <script src="/main.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    
</head>
<body ng-app="FullstackGeneratedApp">
    <navbar></navbar>

    <div ng-controller="DragDropCtrl">

    <div class="item" style="position: absolute;" id="item1" draggable></div>

        <div class="row">
            <div class="main-timeline pull-right col-xs-9">
                <div class="track-row" task_id="1" style="width: 3000px;">
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                </div>

                <div class="track-row" task_id="1" style="width: 3000px;">
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                </div>

                <div class="track-row" task_id="1" style="width: 3000px;">
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                </div>

                <div class="track-row" task_id="1" style="width: 3000px;">
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                </div>

                <div class="track-row" task_id="1" style="width: 3000px;">
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                    <div class="measures" droppable drop="handleDrop()"></div>
                </div>
            </div>
        </div>

    </div>


    <div ui-view></div>
        <button id="play">PLAY</button>
        <button id="stop">STOP</button>
        <button id="record" onclick="toggleRecording(this);">RECORD</button>


    <script>

        // var xhr = new XMLHttpRequest();
        // // xhr.open('GET', 'http://192.168.1.172:1337/api/wav/percussionvocalssynths.wav', true);
        // xhr.responseType = 'blob';

        // xhr.onload = function(e) {
        //   if (this.status == 200) {
        //     // Note: .response instead of .responseText
        //     var blob = new Blob([this.response], {type: 'audio/wav'});
        //         console.log('blob', blob);
        //     }
        // };

        // xhr.send();



        // var t = Tone.Transport;

        // var samples = [
        //     {
        //         startTime : '0m',
        //         player : new Tone.Player("/api/wav/percussionvocalssynths.wav"),
        //         endTime : '16m'
        //     },
        //     {
        //         startTime : '1m',
        //         player : new Tone.Player("/api/wav/bass-loop-3_synths.wav"),
        //         endTime : '3m'
        //     },
        //     {
        //         startTime : '4m',
        //         player : new Tone.Player("/api/wav/drum-loop-32_drums.wav"),
        //         endTime : '12m'
        //     },

        //     {
        //         startTime : '2m',
        //         player : new Tone.Player("/api/wav/drum-loop-41_drums_loop.wav"),
        //         endTime : '3m'
        //     },
        //     {
        //         startTime : '4m',
        //         player : new Tone.Player("/api/wav/drum-loop-41_drums_loop.wav"),
        //         endTime : '5m'
        //     },
        //     {
        //         startTime : '6m',
        //         player : new Tone.Player("/api/wav/drum-loop-41_drums_loop.wav"),
        //         endTime : '7m'
        //     },
        //     {
        //         startTime : '8m',
        //         player : new Tone.Player("/api/wav/drum-loop-41_drums_loop.wav"),
        //         endTime : '9m'
        //     },

        //     {
        //         startTime : '8m',
        //         player : new Tone.Player("/api/wav/synth-loop-7.wav"),
        //         endTime : '12m'
        //     },
        //     {
        //         startTime : '11m',
        //         player : new Tone.Player("/api/wav/vocal-loop-3.wav"),
        //         endTime : '16m'
        //     }
        // ];

        // t.bpm.value = 123;

        // setTimeout(function () {

        //     samples.forEach(function (s) {

        //         s.player.toMaster();
        //         s.player.loop = true;

        //         t.setTimeline(function () {
        //             s.player.stop();
        //             s.player.start();
        //         }, s.startTime);

        //         t.setTimeline(function () {
        //             console.log('End:', t.position);
        //             s.player.stop();
        //         }, s.endTime);

        //     });

        //     t.start();

        // }, 2000);

        // t.loop = true;
        // t.loopStart = '0m';
        // t.loopEnd = '16m';
        // console.log('TRANSPORTTING',t)

        Tone.Transport.setInterval(function () {
            console.log(Tone.Transport.position);
        }, '4n');

        // window.onblur = function () {
        //     t.stop();
        //     samples.forEach(function (s) {
        //         s.player.stop();
        //     });
        // };

        // window.onfocus = function () {
        //     t.start();
        // };
        // // button for recording, button for dropping loop on timeline

        // $('#stop').click(function() {
        //     t.clearTimelines();

        //     samples.forEach(function (s) {
        //         s.player.stop();
        //     });
        //     t.stop();
        // });
        // $('#record').click(function() {
        //     var mic = new Tone.Microphone();
        //     t.clearTimelines();
        //     mic.sync('1m');
        //     var met = new Tone.DrumSynth().toMaster();

        //     t.setTimeline(function () {
        //             met.triggerAttackRelease("C2", "4n");
        //             // met.start();
        //     }, '0m');

        //     t.setTimeline(function () {
        //             mic.start();
        //     }, '1m');

        //     t.setTimeline(function () {
        //             mic.stop();
        //     }, '2m');

        //     // t.start();
        // });
    </script>



    <script>
        var mic, recorder, soundFile;

        var state = 0; // mousePress will increment from Record, to Stop, to Play

        function setup() {
          createCanvas(400,400);
          background(200);
          fill(0);
          text('Enable mic and click the mouse to begin recording', 20, 20);

          // create an audio in
          mic = new p5.AudioIn();

          // users must manually enable their browser microphone for recording to work properly!
          mic.start();

          // create a sound recorder
          recorder = new p5.SoundRecorder();

          // connect the mic to the recorder
          recorder.setInput(mic);

          // create an empty sound file that we will use to playback the recording
          soundFile = new p5.SoundFile();
        }

        function mousePressed() {
          // use the '.enabled' boolean to make sure user enabled the mic (otherwise we'd record silence)
          if (state === 0 && mic.enabled) {

            // Tell recorder to record to a p5.SoundFile which we will use for playback
            recorder.record(soundFile);

            background(255,0,0);
            text('Recording now! Click to stop.', 20, 20);
            state++;
          }

          else if (state === 1) {
            recorder.stop(); // stop recorder, and send the result to soundFile

            background(0,255,0);
            text('Recording stopped. Click to play & save', 20, 20);
            state++;
          }

          else if (state === 2) {
            soundFile.play(); // play the result!
            saveSound(soundFile, 'mySound.wav'); // save file
            state++;
          }
        }
    </script>


</body>
</html>